global:
  tlsDisable: false
server:
  # Move the default TLS-disabled dev listener out of the way so we can add our
  # own listener on 8200 that does use TLS.
  extraArgs: "-dev-listen-address=127.0.0.1:8202 -config=/etc/config/listener.hcl"
  extraEnvironmentVars:
    VAULT_CACERT: /etc/tls/ca.crt
  volumeMounts:
    - name: cert
      mountPath: /etc/tls
      readOnly: true
    - name: config
      mountPath: /etc/config
      readOnly: true
  volumes:
    - name: cert
      secret:
        secretName: vault-cert
    - name: config
      emptyDir: {}
  extraInitContainers:
    - name: write-config
      image: "alpine"
      command: [sh, -c]
      args:
        - |
          cat <<EOF > /etc/config/listener.hcl
          listener "tcp" {
            address = "[::]:8200"
            tls_cert_file = "/etc/tls/tls.crt"
            tls_key_file = "/etc/tls/tls.key"
            proxy_protocol_behavior = "allow_authorized"
            proxy_protocol_authorized_addrs = "[::]:8200"
          }
          EOF
      volumeMounts:
        - name: config
          mountPath: /etc/config
